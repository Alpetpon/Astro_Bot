# Информация о базе данных

## Настройка постоянного хранилища на Amvera

База данных SQLite настроена на использование постоянного хранилища (persistent storage) на Amvera.

### Как это работает:

1. **Локально** (разработка):
   - БД хранится в файле `astro_bot.db` в корневой директории проекта

2. **На Amvera** (production):
   - БД хранится в `/data/astro_bot.db`
   - Директория `/data` смонтирована как persistent volume (настроено в `amvera.yml`)
   - Данные сохраняются между перезапусками и деплоями

### Конфигурация:

**amvera.yml:**
```yaml
run:
  persistenceMount: /data
```

**config.py:**
- Автоматически определяет окружение
- Использует `/data` если директория существует (production)
- Использует локальную директорию для разработки

**Dockerfile:**
- Создает директорию `/data` с правами доступа 777
- Обновлена дата сборки для форсированного пересоздания контейнера

### Проверка работы:

После деплоя проверьте логи:
```
Initializing database at: sqlite:////data/astro_bot.db
Using persistent storage: sqlite:////data/astro_bot.db
```

Если видите эти сообщения - значит БД использует постоянное хранилище ✅

### Миграция на PostgreSQL (опционально):

Для больших нагрузок рекомендуется PostgreSQL:

1. Создайте PostgreSQL базу на Amvera или внешнем сервисе
2. Установите переменную окружения `DATABASE_URL`:
   ```
   DATABASE_URL=postgresql://user:password@host:port/database
   ```
3. Обновите `requirements.txt`:
   ```
   psycopg2-binary
   ```

## Резервное копирование

Рекомендуется периодически делать резервные копии БД:
- SQLite: скопировать файл `/data/astro_bot.db`
- PostgreSQL: использовать `pg_dump`

